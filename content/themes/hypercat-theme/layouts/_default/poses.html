{{- define "main" }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', function() {
        if (window.jQuery && jQuery.fn.justifiedGallery) {
            jQuery('.poses-grid').justifiedGallery({
                rowHeight: 220,
                margins: 16,
                lastRow: 'nojustify',
                captions: false,
                imagesSelector: 'img'
            });
        }
    });
</script>
<header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
</header>

<div class="poses-container">
        {{- $poseCategories := slice "solo" "duo" "triple" "groups" }}
        
        {{- range $poseCategories }}
        {{- $category := . }}
        {{- $section := $.Site.GetPage (printf "/poses/%s" $category) }}
        {{- $categoryTitle := "Gallery" }}
        {{- if $section }}
            {{- $categoryTitle = $section.Title }}
        {{- end }}
        
        {{- /* Get images from the section's resources */ -}}
        {{- $images := slice }}
        {{- if $section }}
            {{- range $section.Resources.Match "*.{jpg,jpeg,png,webp,gif}" }}
                {{- $images = $images | append . }}
            {{- end }}
        {{- end }}
        
        <section class="poses-section">
            <h2 class="poses-section-title">{{ $categoryTitle }}</h2>
            {{- if gt (len $images) 0 }}
                <div class="poses-grid">
                    {{- range $images }}
                    {{- $small := .Fit "300x2000 q85" }}
                    {{- $medium := .Fit "600x2000 q85" }}
                    {{- $large := .Fit "1200x2000 q85" }}
                    <a href="{{ $large.RelPermalink }}" class="poses-image-link" data-lg-size="{{ $large.Width }}-{{ $large.Height }}" data-title="{{ .Name }}">
                        <img 
                            src="{{ $small.RelPermalink }}" 
                            srcset="{{ $small.RelPermalink }} 300w, {{ $medium.RelPermalink }} 600w, {{ $large.RelPermalink }} 1200w"
                            sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"
                            alt="{{ .Name }}"
                            class="poses-grid-image"
                            loading="lazy"
                        >
                    </a>
                    {{- end }}
                </div>
            {{- else }}
                <p class="poses-empty-gallery">No images yet. Add images to <code>content/poses/{{ $category }}/</code></p>
            {{- end }}
        </section>
        {{- end }}
    </div>

</article>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', function() {
        if (window.jQuery && jQuery.fn.justifiedGallery) {
            jQuery('.poses-grid').justifiedGallery({
                rowHeight: 220,
                margins: 16,
                lastRow: 'nojustify',
                captions: false,
                imagesSelector: 'img'
            });
        }
        // Initialize GLightbox for open source lightbox functionality
        try {
            var grid = document.querySelector('.poses-grid');
            if (window.GLightbox && grid) {
                GLightbox({ selector: '.poses-grid a' });
                console.log('GLightbox initialized');
            } else {
                console.warn('GLightbox or .poses-grid not found');
            }
        } catch (e) {
            console.error('GLightbox initialization failed:', e);
        }
    });
</script>
{{- end }}
