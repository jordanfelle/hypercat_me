name: Monthly Site Rebuild

on:
  schedule:
    # Run at 00:00 UTC on the 1st of every month
    - cron: "0 0 1 * *"
  workflow_dispatch: # Allow manual triggering for testing

jobs:
  trigger-rebuild:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Cloudflare Pages Rebuild
        env:
          WEBHOOK_URL: ${{ secrets.CLOUDFLARE_PAGES_BUILD_WEBHOOK }}
        run: |
          if [ -z "$WEBHOOK_URL" ]; then
            echo "Error: CLOUDFLARE_PAGES_BUILD_WEBHOOK secret is not set"
            echo "Please configure the secret in repository settings"
            exit 1
          fi

          curl -f -s -S -X POST "$WEBHOOK_URL" \
            -H "Content-Type: application/json" \
            -d '{}'
          echo "Build webhook triggered successfully"
